const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StudentSelector-DN8zojFT.js","assets/index-DUO3hN4v.js","assets/index-C8jj41if.css"])))=>i.map(i=>d[i]);
import{r as a,j as e,_ as B}from"./index-DUO3hN4v.js";import{c as G,F as P}from"./Footer-C-mZJSc6.js";function K({onLogin:h}){const[l,g]=a.useState(""),[c,x]=a.useState(""),[i,o]=a.useState(""),j=async t=>{t.preventDefault(),o(""),(await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,password:c})})).ok?h():o("로그인 실패: 아이디 또는 비밀번호가 올바르지 않습니다.")};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"login-form",onSubmit:j,children:[e.jsx("div",{className:"bg-blur"}),e.jsx("img",{src:G,alt:"CAHS Logo",className:"login-form-logo"}),e.jsx("h2",{className:"login-form-title",children:"관리자 로그인"}),e.jsx("input",{type:"text",placeholder:"ID",value:l,onChange:t=>g(t.target.value),required:!0,className:"login-form-input"}),e.jsx("input",{type:"password",placeholder:"비밀번호",value:c,onChange:t=>x(t.target.value),required:!0,className:"login-form-input"}),e.jsx("button",{type:"submit",className:"login-form-btn",children:"로그인"}),i&&e.jsx("div",{className:"login-form-error",children:i})]}),e.jsx("div",{className:"footer-text",children:e.jsx(P,{})})]})}const Q=a.lazy(()=>B(()=>import("./StudentSelector-DN8zojFT.js"),__vite__mapDeps([0,1,2]))),Z=()=>{const[h,l]=a.useState(""),[g,c]=a.useState(!1),[x,i]=a.useState(!1),[o,j]=a.useState(null),[t,m]=a.useState(""),[I,_]=a.useState(""),[E,p]=a.useState(!1),[f,b]=a.useState(null),[y,w]=a.useState(""),[N,L]=a.useState(""),[W,T]=a.useState(!1),[A,k]=a.useState(!1),[F,S]=a.useState(!1),[v,C]=a.useState(null),[J,D]=a.useState([]);if(a.useEffect(()=>{fetch("/api/check-auth").then(s=>s.json()).then(s=>{j(s.authenticated),s.authenticated&&s.class&&(m(s.class),w(s.class)),s.authenticated&&s.name&&_(s.name)}),fetch("/api/classes").then(s=>s.json()).then(s=>{D(s.classes||[])})},[]),o===null)return e.jsx("div",{className:"admin-loading",children:"로딩 중..."});if(!o)return e.jsx(K,{onLogin:()=>window.location.reload()});const U=async()=>{try{(await(await fetch("/api/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:"",studentId:""})})).json()).success&&(i(!0),setTimeout(()=>i(!1),800))}catch(s){console.error(s)}},M=async(s,n,r=!1)=>{try{const u=await(await fetch("/api/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:s,studentId:n,force:r})})).json();u.warning&&!r?(p(!0),b({classId:s,studentId:n})):u.success&&(c(!0),setTimeout(()=>c(!1),800))}catch(d){console.error(d)}},q=async()=>{M(t,h)},R=async()=>{f&&(await M(f.classId,f.studentId,!0),p(!1),b(null))},z=async()=>{try{(await(await fetch("/api/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:"",messageText:""})})).json()).success&&(k(!0),setTimeout(()=>k(!1),800))}catch(s){console.error(s)}},O=async(s,n,r=!1)=>{try{const u=await(await fetch("/api/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:s,messageText:n,force:r})})).json();u.warning&&!r?(S(!0),C({classId:s,messageText:n})):u.success&&(T(!0),setTimeout(()=>T(!1),800))}catch(d){console.error(d)}},H=async()=>{N.trim()&&O(y||t,N)},V=async()=>{v&&(await O(v.classId,v.messageText,!0),S(!1),C(null))};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("div",{className:"bg-admin"}),e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{className:"admin-title",children:"관리"}),e.jsxs("div",{className:"admin-user-info right",children:[I," 선생님",e.jsx("button",{className:"admin-logout-btn",onClick:async()=>{await fetch("/api/logout",{method:"POST"}),window.location.reload()},children:"로그아웃"})]})]}),"        ",e.jsxs("div",{className:"admin-flex-row",children:[e.jsxs("div",{className:"call-manager",children:[e.jsx("h2",{className:"submenu-title",children:"학생 호출"}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"반"}),e.jsx("input",{type:"text",value:t,onChange:s=>m(s.target.value),placeholder:"0-0"})]}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"학번"}),e.jsx("input",{type:"text",value:h,onChange:s=>l(s.target.value),placeholder:"00"})]}),e.jsx("button",{className:g?"call-btn success":"call-btn",onClick:q,children:"호출"}),e.jsx("button",{className:x?"clear-btn success":"clear-btn",onClick:U,children:"호출 해제"})]}),"          ",e.jsxs("div",{className:"call-manager",children:[e.jsx("h2",{className:"submenu-title",children:"메시지 전송"}),"            ",e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"반"}),e.jsxs("select",{value:y,onChange:s=>w(s.target.value),"aria-label":"반 선택",children:[e.jsx("option",{value:"",children:"반 선택"}),J.map(s=>e.jsxs("option",{value:s,children:[s,"반"]},s))]})]}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"내용"}),e.jsx("input",{type:"text",value:N,onChange:s=>L(s.target.value),placeholder:"메시지 입력"})]}),e.jsx("button",{className:W?"call-btn success":"call-btn",onClick:H,children:"전송"}),e.jsx("button",{className:A?"clear-btn success":"clear-btn",onClick:z,children:"메시지 해제"})]}),e.jsx("div",{className:"student-list-panel",children:e.jsx(a.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(Q,{onSelect:(s,n)=>{m(s),l(n)}})})}),"        "]}),E&&e.jsx("div",{className:"call-warning-modal",children:e.jsxs("div",{className:"call-warning-content",children:[e.jsx("p",{children:"경고: 본인 반 학생이 아닙니다. 그래도 호출하시겠습니까?"}),e.jsxs("div",{className:"call-warning-btn-row",children:[e.jsx("button",{className:"call-btn",onClick:R,children:"확인"}),e.jsx("button",{className:"clear-btn",onClick:()=>{p(!1),b(null)},children:"취소"})]})]})}),F&&e.jsx("div",{className:"call-warning-modal",children:e.jsxs("div",{className:"call-warning-content",children:[e.jsx("p",{children:"경고: 본인 반이 아닙니다. 그래도 메시지를 전송하시겠습니까?"}),e.jsxs("div",{className:"call-warning-btn-row",children:[e.jsx("button",{className:"call-btn",onClick:V,children:"확인"}),e.jsx("button",{className:"clear-btn",onClick:()=>{S(!1),C(null)},children:"취소"})]})]})}),e.jsx("div",{className:"footer-text",children:e.jsx(P,{})})]})})};export{Z as default};

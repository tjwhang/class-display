const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StudentSelector-B6jPB3dZ.js","assets/index-Dh4BDzNg.js","assets/index-t4S-MXB9.css"])))=>i.map(i=>d[i]);
import{r as a,j as e,_ as ie}from"./index-Dh4BDzNg.js";import{c as re,F as U}from"./Footer-pdzdAA5e.js";function de({onLogin:h}){const[i,x]=a.useState(""),[r,j]=a.useState(""),[d,u]=a.useState(""),f=async t=>{t.preventDefault(),u(""),(await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,password:r})})).ok?h():u("로그인 실패: 아이디 또는 비밀번호가 올바르지 않습니다.")};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"login-form",onSubmit:f,children:[e.jsx("div",{className:"bg-blur"}),e.jsx("img",{src:re,alt:"CAHS Logo",className:"login-form-logo"}),e.jsx("h2",{className:"login-form-title",children:"관리자 로그인"}),e.jsx("input",{type:"text",placeholder:"ID",value:i,onChange:t=>x(t.target.value),required:!0,className:"login-form-input"}),e.jsx("input",{type:"password",placeholder:"비밀번호",value:r,onChange:t=>j(t.target.value),required:!0,className:"login-form-input"}),e.jsx("button",{type:"submit",className:"login-form-btn",children:"로그인"}),d&&e.jsx("div",{className:"login-form-error",children:d})]}),e.jsx("div",{className:"footer-text",children:e.jsx(U,{})})]})}const ue=a.lazy(()=>ie(()=>import("./StudentSelector-B6jPB3dZ.js"),__vite__mapDeps([0,1,2]))),me=()=>{const[h,i]=a.useState(""),[x,r]=a.useState(!1),[j,d]=a.useState(!1),[u,f]=a.useState(null),[t,g]=a.useState(""),[q,R]=a.useState(""),[z,p]=a.useState(!1),[b,N]=a.useState(null),[m,S]=a.useState(""),[C,H]=a.useState(""),[V,O]=a.useState(!1),[B,P]=a.useState(!1),[G,v]=a.useState(!1),[w,y]=a.useState(null),[I,W]=a.useState(""),[T,K]=a.useState(""),[Q,_]=a.useState(!1),[X,E]=a.useState(!1),[Y,M]=a.useState(!1),[L,k]=a.useState(null),[J,Z]=a.useState([]);if(a.useEffect(()=>{fetch("/api/check-auth").then(s=>s.json()).then(s=>{f(s.authenticated),s.authenticated&&s.class&&(g(s.class),S(s.class),W(s.class)),s.authenticated&&s.name&&R(s.name)}),fetch("/api/classes").then(s=>s.json()).then(s=>{Z(s.classes||[])})},[]),a.useEffect(()=>{t&&!m&&S(t)},[t,m]),u===null)return e.jsx("div",{className:"admin-loading",children:"로딩 중..."});if(!u)return e.jsx(de,{onLogin:()=>window.location.reload()});const $=async()=>{try{(await(await fetch("/api/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:"",studentId:""})})).json()).success&&(d(!0),setTimeout(()=>d(!1),800))}catch(s){console.error(s)}},A=async(s,n,l=!1)=>{try{const o=await(await fetch("/api/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:s,studentId:n,force:l})})).json();o.warning&&!l?(p(!0),N({classId:s,studentId:n})):o.success&&(r(!0),setTimeout(()=>r(!1),800))}catch(c){console.error(c)}},ee=async()=>{A(t,h)},se=async()=>{b&&(await A(b.classId,b.studentId,!0),p(!1),N(null))},ae=async()=>{try{(await(await fetch("/api/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:"",messageText:""})})).json()).success&&(P(!0),setTimeout(()=>P(!1),800))}catch(s){console.error(s)}},F=async(s,n,l=!1)=>{try{const o=await(await fetch("/api/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:s,messageText:n,force:l})})).json();o.warning&&!l?(v(!0),y({classId:s,messageText:n})):o.success&&(O(!0),setTimeout(()=>O(!1),800))}catch(c){console.error(c)}},te=async()=>{C.trim()&&F(m||t,C)},ne=async()=>{w&&(await F(w.classId,w.messageText,!0),v(!1),y(null))},le=async()=>{try{(await(await fetch("/api/long-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:"",messageText:""})})).json()).success&&(E(!0),setTimeout(()=>E(!1),800))}catch(s){console.error(s)}},D=async(s,n,l=!1)=>{try{const o=await(await fetch("/api/long-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:s,messageText:n,force:l})})).json();o.warning&&!l?(M(!0),k({classId:s,messageText:n})):o.success&&(_(!0),setTimeout(()=>_(!1),800))}catch(c){console.error(c)}},ce=async()=>{T.trim()&&D(I||t,T)},oe=async()=>{L&&(await D(L.classId,L.messageText,!0),M(!1),k(null))};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("div",{className:"bg-admin"}),e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{className:"admin-title",children:"관리"}),e.jsxs("div",{className:"admin-user-info right",children:[q," 선생님",e.jsx("button",{className:"admin-logout-btn",onClick:async()=>{await fetch("/api/logout",{method:"POST"}),window.location.reload()},children:"로그아웃"})]})]}),"        ",e.jsxs("div",{className:"admin-flex-row",children:[e.jsxs("div",{className:"call-manager",children:[e.jsx("h2",{className:"submenu-title",children:"학생 호출"}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"반"}),e.jsx("input",{type:"text",value:t,onChange:s=>g(s.target.value),placeholder:"0-0"})]}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"학번"}),e.jsx("input",{type:"text",value:h,onChange:s=>i(s.target.value),placeholder:"00"})]}),e.jsx("button",{className:x?"call-btn success":"call-btn",onClick:ee,children:"호출"}),e.jsx("button",{className:j?"clear-btn success":"clear-btn",onClick:$,children:"호출 해제"})]}),e.jsxs("div",{className:"call-manager",children:[e.jsx("h2",{className:"submenu-title",children:"짧은 메시지 전송"}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"반"}),e.jsx("select",{value:m,onChange:s=>S(s.target.value),"aria-label":"반 선택",children:J.map(s=>e.jsxs("option",{value:s,children:[s,"반"]},s))})]}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"내용"}),e.jsx("input",{type:"text",value:C,onChange:s=>H(s.target.value),placeholder:"메시지 입력"})]}),e.jsx("button",{className:V?"call-btn success":"call-btn",onClick:te,children:"전송"}),e.jsx("button",{className:B?"clear-btn success":"clear-btn",onClick:ae,children:"메시지 해제"})]}),e.jsx("div",{className:"student-list-panel",children:e.jsx(a.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(ue,{onSelect:(s,n)=>{g(s),i(n)}})})})]}),e.jsx("div",{className:"admin-flex-row",children:e.jsxs("div",{className:"call-manager",children:[e.jsx("h2",{className:"submenu-title",children:"중요 공지 표시"}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"반"}),e.jsx("select",{value:I,onChange:s=>W(s.target.value),"aria-label":"반 선택",children:J.map(s=>e.jsxs("option",{value:s,children:[s,"반"]},s))})]}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"내용"}),e.jsx("textarea",{value:T,onChange:s=>K(s.target.value),placeholder:"긴 메시지 입력 (여러 줄 가능)",rows:4,className:"long-message-textarea"})]}),e.jsx("button",{className:Q?"call-btn success":"call-btn",onClick:ce,children:"메시지 전송"}),e.jsx("button",{className:X?"clear-btn success":"clear-btn",onClick:le,children:"해제"})]})}),z&&e.jsx("div",{className:"call-warning-modal",children:e.jsxs("div",{className:"call-warning-content",children:[e.jsx("p",{children:"경고: 본인 반 학생이 아닙니다. 그래도 호출하시겠습니까?"}),e.jsxs("div",{className:"call-warning-btn-row",children:[e.jsx("button",{className:"call-btn",onClick:se,children:"확인"}),e.jsx("button",{className:"clear-btn",onClick:()=>{p(!1),N(null)},children:"취소"})]})]})}),G&&e.jsx("div",{className:"call-warning-modal",children:e.jsxs("div",{className:"call-warning-content",children:[e.jsx("p",{children:"경고: 본인 반이 아닙니다. 그래도 메시지를 전송하시겠습니까?"}),e.jsxs("div",{className:"call-warning-btn-row",children:[e.jsx("button",{className:"call-btn",onClick:ne,children:"확인"}),e.jsx("button",{className:"clear-btn",onClick:()=>{v(!1),y(null)},children:"취소"})]})]})}),Y&&e.jsx("div",{className:"call-warning-modal",children:e.jsxs("div",{className:"call-warning-content",children:[e.jsx("p",{children:"경고: 본인 반이 아닙니다. 그래도 긴 메시지를 전송하시겠습니까?"}),e.jsxs("div",{className:"call-warning-btn-row",children:[e.jsx("button",{className:"call-btn",onClick:oe,children:"확인"}),e.jsx("button",{className:"clear-btn",onClick:()=>{M(!1),k(null)},children:"취소"})]})]})}),e.jsx("div",{className:"footer-text",children:e.jsx(U,{})})]})})};export{me as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StudentSelector-DZf5XDr-.js","assets/main-BIkQ7q39.js","assets/main-Iw5AehNi.css"])))=>i.map(i=>d[i]);
import{r as t,j as e,_ as I}from"./main-BIkQ7q39.js";import{c as O,F as v}from"./Footer-BEKXYf4o.js";function P({onLogin:r}){const[n,u]=t.useState(""),[l,m]=t.useState(""),[c,i]=t.useState(""),h=async a=>{a.preventDefault(),i(""),(await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:l})})).ok?r():i("로그인 실패: 아이디 또는 비밀번호가 올바르지 않습니다.")};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"login-form",onSubmit:h,children:[e.jsx("div",{className:"bg-blur"}),e.jsx("img",{src:O,alt:"CAHS Logo",className:"login-form-logo"}),e.jsx("h2",{className:"login-form-title",children:"관리자 로그인"}),e.jsx("input",{type:"text",placeholder:"ID",value:n,onChange:a=>u(a.target.value),required:!0,className:"login-form-input"}),e.jsx("input",{type:"password",placeholder:"비밀번호",value:l,onChange:a=>m(a.target.value),required:!0,className:"login-form-input"}),e.jsx("button",{type:"submit",className:"login-form-btn",children:"로그인"}),c&&e.jsx("div",{className:"login-form-error",children:c})]}),e.jsx("div",{className:"footer-text",children:e.jsx(v,{})})]})}const _=t.lazy(()=>I(()=>import("./StudentSelector-DZf5XDr-.js"),__vite__mapDeps([0,1,2]))),F=()=>{const[r,n]=t.useState(""),[u,l]=t.useState(!1),[m,c]=t.useState(!1),[i,h]=t.useState(null),[a,d]=t.useState(""),[b,y]=t.useState(""),[C,x]=t.useState(!1),[j,p]=t.useState(null);if(t.useEffect(()=>{fetch("/api/check-auth").then(s=>s.json()).then(s=>{h(s.authenticated),s.authenticated&&s.class&&d(s.class),s.authenticated&&s.name&&y(s.name)})},[]),i===null)return e.jsx("div",{className:"admin-loading",children:"로딩 중..."});if(!i)return e.jsx(P,{onLogin:()=>window.location.reload()});const w=async()=>{try{(await(await fetch("/api/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:"",studentId:""})})).json()).success&&(c(!0),setTimeout(()=>c(!1),800))}catch(s){console.error(s)}},f=async(s,o,g=!1)=>{try{const S=await(await fetch("/api/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:s,studentId:o,force:g})})).json();S.warning&&!g?(x(!0),p({classId:s,studentId:o})):S.success&&(l(!0),setTimeout(()=>l(!1),800))}catch(N){console.error(N)}},T=async()=>{f(a,r)},k=async()=>{j&&(await f(j.classId,j.studentId,!0),x(!1),p(null))};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("div",{className:"bg-admin"}),e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{className:"admin-title",children:"관리"}),e.jsxs("div",{className:"admin-user-info right",children:[b," 선생님",e.jsx("button",{className:"admin-logout-btn",onClick:async()=>{await fetch("/api/logout",{method:"POST"}),window.location.reload()},children:"로그아웃"})]})]}),e.jsxs("div",{className:"admin-flex-row",children:[e.jsxs("div",{className:"call-manager",children:[e.jsx("h2",{className:"submenu-title",children:"학생 호출"}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"반"}),e.jsx("input",{type:"text",value:a,onChange:s=>d(s.target.value),placeholder:"0-0"})]}),e.jsxs("div",{className:"input-format",children:[e.jsx("label",{children:"학번"}),e.jsx("input",{type:"text",value:r,onChange:s=>n(s.target.value),placeholder:"00"})]}),e.jsx("button",{className:u?"call-btn success":"call-btn",onClick:T,children:"호출"}),e.jsx("button",{className:m?"clear-btn success":"clear-btn",onClick:w,children:"호출 해제"}),C&&e.jsx("div",{className:"call-warning-modal",children:e.jsxs("div",{className:"call-warning-content",children:[e.jsx("p",{children:"경고: 본인 반 학생이 아닙니다. 그래도 호출하시겠습니까?"}),e.jsxs("div",{className:"call-warning-btn-row",children:[e.jsx("button",{className:"call-btn",onClick:k,children:"확인"}),e.jsx("button",{className:"clear-btn",onClick:()=>{x(!1),p(null)},children:"취소"})]})]})})]}),e.jsx("div",{className:"student-list-panel",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(_,{onSelect:(s,o)=>{d(s),n(o)}})})})]}),e.jsx("div",{className:"footer-text",children:e.jsx(v,{})})]})})};export{F as default};
